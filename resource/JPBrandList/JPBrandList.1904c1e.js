function init(){$.ajax({type:"GET",url:"../../resource/JPBrandList/JPBrandList.json"}).done(function(n){if(n&&n.success){var e=[],t='<option value="-1">--全部--</option>';$.each(n.result,function(n){return this.name=$.trim(this.name),this.brand=$.trim(this.brand),this.power=$.trim(this.power),this.link=$.trim(this.link),this.remark=$.trim(this.remark),this.id=n,e[this.brand]?!0:(e[this.brand]=this.brand,void(t+='<option value="'+this.brand+'">'+this.brand+"</option>"))}),$("#J_brand").empty().append(t).selectPicker();var i=Mustache.render($("#J_template").html(),{list:n.result});$("#formList").append(i)}}).fail(function(){alert("查询失败")})}function search(){var n=$.trim($("#J_name").val()).toLowerCase(),e=$("#J_brand").val(),t=$(".J_power:checked").val(),i=$.trim($("#J_link").val());$(".rowList").removeClass("hidden"),""==n&&"-1"==e&&"-1"==t&&""==i||$(".rowList").each(function(){var a=$(this),r=a.find(".name").text().toLowerCase(),d=a.find(".brand").text(),o=a.find(".power").text(),s=a.find(".link").text();""!=n&&(n==r||-1!=r.indexOf(n)?a.removeClass("hidden"):a.addClass("hidden")),"-1"!=e&&(e!=d||a.hasClass("hidden")?a.addClass("hidden"):a.removeClass("hidden")),"-1"!=t&&(t!=o||a.hasClass("hidden")?a.addClass("hidden"):a.removeClass("hidden")),""!=i&&(i!=s||a.hasClass("hidden")?a.addClass("hidden"):a.removeClass("hidden"))})}function fuzzySearch(n,e){var t=$.trim(e.val()),i=[];if($(".fuzzyUl").remove(),t){var a=1==n?".name":".link";if($(".rowList").each(function(){var n=$(this).find(a).text();-1!=n.indexOf(t)&&-1==i.indexOf(n)&&i.push(n)}),0!=i.length){var r='<ul class="fuzzy-ul fuzzyUl">';$.each(i,function(){r+="<li>"+this+"</li>"}),r+="</ul>",e.after(r)}}}function _cancel(){$("#J_inputName").val(""),$("#J_inputBrand").val(""),$("#J_inputLink").val(""),$("#J_inputRemark").val(""),$("#newBox").addClass("hidden")}function funDownload(n,e){var t=document.createElement("a");t.download=e,t.style.display="none";var i=new Blob([n]);t.href=URL.createObjectURL(i),document.body.appendChild(t),t.click(),document.body.removeChild(t)}$(document).ready(function(){init(),$("#J_name,#J_inputName").on("valuechange keyup",function(){fuzzySearch(1,$(this))}),$("#J_link,#J_inputLink").on("valuechange keyup",function(){fuzzySearch(2,$(this))}),$(".bd,#newBox").on("click",".fuzzyUl li",function(){var n=$(this),e=n.text();n.closest(".fuzzyBox").find("input").val(e),$(".fuzzyUl").remove()}),$("#J_search").on("click",search),$("#formSubmit").on("keyup",function(n){13==n.keyCode&&search()}),$("#J_new").on("click",function(){$("#newBox").removeClass("hidden").data("id",$(".rowList").length)}),$("#formList").on("click",".J_update",function(){var n=$(this),e=n.data("id"),t=n.closest(".rowList");$("#newBox").removeClass("hidden").data("id",e),$("#J_inputName").val(t.find(".name").text()),$("#J_inputBrand").val(t.find(".brand").text()),$('.J_newPower[value="'+t.find(".power").text()+'"]').prop("checked",!0),$("#J_inputLink").val(t.find(".link").text()),$("#J_inputRemark").val(t.find(".remark").text())}),$("#J_sureNew").on("click",function(){var n=$("#newBox").data("id"),e=$(".rowList").length,t=$.trim($("#J_inputName").val()),i=$.trim($("#J_inputBrand").val()),a=$(".J_newPower:checked").val(),r=$.trim($("#J_inputLink").val()),d=$.trim($("#J_inputRemark").val());if(""==t&&""==i&&""==a&&""==r&&""==d)return alert("内容为空，请至少设置一项参数");var o=n==e?"新增":"修改";if(confirm("确定"+o+"？")){if(n==e){var s=[];s[0]={},s[0].id=$("#newBox").data("id"),s[0].name=t,s[0].brand=i,s[0].power=a,s[0].link=r,s[0].remark=d;var l=Mustache.render($("#J_template").html(),{list:s});$("#formList .row").eq(0).after(l)}else{var c=$('.rowList[data-id="'+n+'"]');c.find(".name").text(t),c.find(".brand").text(i),c.find(".power").text(a),c.find(".link").text(r),c.find(".remark").text(d)}_cancel()}}),$("#J_cancelNew").on("click",function(){_cancel()}),$(document).on("click",function(n){var e=$(n.target);0==e.closest(".container-new,#J_new,.J_update,.fuzzyUl").length&&_cancel()}),$("#J_save").on("click",function(){var n={},e=[];$(".rowList").each(function(n){var t=$(this);e[n]={},e[n].name=t.find(".name").text(),e[n].brand=t.find(".brand").text(),e[n].power=t.find(".power").text(),e[n].link=t.find(".link").text(),e[n].remark=t.find(".remark").text()}),n.result=e,n.success=!0,funDownload(JSON.stringify(n),"JPBrandList.json"),alert('请至 "上传" 菜单栏上传 "JPBrandList.json" 文件')})});